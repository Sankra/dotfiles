#!/usr/bin/env bash

echo "Configure a new Mac"

echo "All access"
sudo -v

echo "All access all the time"
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

echo "Copying bash profile..."

cp ./.bash-profile ~/.bash-profile -f

echo "Security & Privacy"
# Enable FileVault
fdesetup enable

# Enable firewall
defaults write /Library/Preferences/com.apple.alf globalstate -int 1

launchctl unload /System/Library/LaunchAgents/com.apple.alf.useragent.plist
launchctl unload /System/Library/LaunchDaemons/com.apple.alf.agent.plist

launchctl load /System/Library/LaunchDaemons/com.apple.alf.agent.plist
launchctl load /System/Library/LaunchAgents/com.apple.alf.useragent.plist

# Ask for password earlier
defaults write com.apple.screensaver askForPasswordDelay -int 0

echo "XCode commandline tools"
xcode-select --install

echo "Homebrew"
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

echo "Install brews listed in brews.txt"
sh installBrews

echo "Install casks listed in casks.txt"
sh installCasks

echo "Adjusting Dock."

# Minimize windows into their applicationâ€™s icon
defaults write com.apple.dock minimize-to-application -bool true

# Show indicator lights for open applications in the Dock
defaults write com.apple.dock show-process-indicators -bool false

# Position (left, bottom, right)
defaults write com.apple.dock orientation -string "left"

# Disable double-click a window's title bar to minimize
defaults write NSGlobalDomain AppleMiniaturizeOnDoubleClick -bool false

echo "Dark mode"
defaults write /Library/Preferences/.GlobalPreferences AppleInterfaceTheme Dark

killall Dock
killall SystemUIServer

echo "Adjusting Finder"

# When performing a search, search the current folder by default
defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"

# no warning prompt when changing file extension
defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false 

# New window points to projects
defaults write com.apple.finder NewWindowTarget -string "PfLo" "file://~/projects"

# Show icons for servers on the desktop
defaults write com.apple.finder ShowMountedServersOnDesktop -bool true

# Disable the warning before emptying the Trash
defaults write com.apple.finder WarnOnEmptyTrash -bool false
